<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Sayonara</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: radial-gradient(ellipse at bottom, #0d1b2a 0%, #000000 100%);
            height: 100vh;
            height: 100dvh; 
            width: 100vw;
            font-family: 'Arial', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            cursor: default;
        }
        
        .space {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            /* Performance: Hint browser to promote layer */
            transform: translateZ(0); 
        }
        
        .star {
            position: absolute;
            border-radius: 50%;
            /* Optimization: Use opacity/transform instead of box-shadow animation */
            opacity: 0.7;
            animation: twinkle var(--duration) ease-in-out infinite;
            animation-delay: var(--delay);
            /* Static subtle glow is cheaper than animated glow */
            box-shadow: 0 0 4px 1px rgba(255, 255, 255, 0.3);
        }

        /* GPU Accelerated Animation */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .pulsar {
            animation: pulse 4s ease-in-out infinite !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0.5; }
        }
        
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            /* Reduced shadow complexity */
            box-shadow: 0 0 5px 1px rgba(255,255,255,0.8);
            pointer-events: none;
            z-index: 2;
            opacity: 0; /* Hidden by default */
        }
        
        .shooting-star::before {
            content: '';
            position: absolute;
            top: 0;
            right: 2px;
            height: 2px;
            width: 80px; /* Slightly shorter */
            background: linear-gradient(90deg, rgba(255,255,255,0.8), transparent);
        }
        
        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            opacity: 0.08; /* Lower opacity for subtle effect */
            filter: blur(40px); /* Slightly reduced blur radius for performance */
            animation: nebulaDrift 40s ease-in-out infinite;
            pointer-events: none;
            will-change: transform;
        }
        
        @keyframes nebulaDrift {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, -15px) scale(1.05); }
        }
        
        .lyrics-container {
            position: fixed;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
            max-width: 800px;
            z-index: 1000;
            padding: 0 20px;
            pointer-events: none;
            /* Promote to own layer to prevent repainting stars when text changes */
            will-change: opacity, transform; 
        }
        
        .lyrics {
            font-size: clamp(20px, 6vw, 32px);
            color: white;
            /* Optimized text shadow */
            text-shadow: 0 0 10px rgba(0,0,0,0.8); 
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
            line-height: 1.4;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .lyrics.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .lyrics-container { bottom: 20%; }
            .nebula { filter: blur(30px); width: 200px; height: 200px; } /* Reduce heavy blur on mobile */
        }
    </style>
</head>
<body>
    <div class="space" id="space"></div>
    
    <div class="lyrics-container">
        <div class="lyrics" id="lyrics"></div>
    </div>
    
    <audio id="audio" loop playsinline preload="auto">
        <source src="sayonara.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const space = document.getElementById('space');
            const audio = document.getElementById('audio');
            const lyricsDisplay = document.getElementById('lyrics');
            
            // Reduced particle count for performance
            const isMobile = window.innerWidth < 768;
            const numStars = isMobile ? 60 : 150; 
            
            let currentLyricIndex = -1;
            let audioStarted = false;

            const lyricsData = [
                { time: 0, text: "♪ ♪ ♪" },
                { time: 27, text: "Sayonara, sweet memories" },
                { time: 33, text: "It's goodbye..." },
                { time: 38, text: "Sayonara, don't look back" },
                { time: 43, text: "Don't ask why..." },
                { time: 48, text: "The time to come, will come" },
                { time: 53, text: "And you will go, alone" },
                { time: 59, text: "Keep to your heart..." },
                { time: 65, text: "Sayonara..." },
                { time: 77, text: "And so my friend" },
                { time: 79, text: "Now it must end" },
                { time: 82, text: "Now you are grown" },
                { time: 87, text: "I can't stay on" },
                { time: 90, text: "Think of the memories, we've known" },
                { time: 97, text: "Carefully feeling your way" },
                { time: 102, text: "You're getting stronger each day" },
                { time: 108, text: "How can I find words to say" },
                { time: 113, text: "I'll miss you..." },
                { time: 118, text: "Sayonara, sweet memories" },
                { time: 124, text: "It's goodbye..." },
                { time: 129, text: "Sayonara, don't look back" },
                { time: 135, text: "Don't ask why..." },
                { time: 139, text: "The time to come, will come" },
                { time: 145, text: "And you will go, alone" },
                { time: 150, text: "Keep to your heart..." },
                { time: 157, text: "Sayonara..." },
                { time: 168, text: "♪ ♪ ♪" },
                { time: 188, text: "Carefully feeling your way" },
                { time: 193, text: "You're getting stronger each day" },
                { time: 199, text: "How can I find words to say" },
                { time: 204, text: "I'll miss you..." },
                { time: 209, text: "Sayonara, sweet memories" },
                { time: 214, text: "It's goodbye..." },
                { time: 220, text: "Sayonara, don't look back" },
                { time: 225, text: "Don't ask why..." },
                { time: 230, text: "The time to come, will come" },
                { time: 236, text: "And you will go, alone" },
                { time: 241, text: "Keep to your heart..." },
                { time: 248, text: "Sayonara..." },
                { time: 259, text: "Sayonara..." },
                { time: 269, text: "The time to come, will come" },
                { time: 274, text: "And you will go, alone" },
                { time: 280, text: "Keep to your heart..." },
                { time: 286, text: "Sayonara..." },
                { time: 297, text: "Sayonara..." },
                { time: 307, text: "♪ ♪ ♪" }
            ];
            
            // --- Initialization Logic ---
            
            // Use DocumentFragment for batch DOM insertion (Performance)
            function startVisuals() {
                const fragment = document.createDocumentFragment();
                
                // Nebulas
                const nebulaColors = ['#4a148c', '#1a237e', '#0d47a1', '#006064'];
                const nebulaCount = isMobile ? 1 : 3;
                for (let i = 0; i < nebulaCount; i++) {
                    const nebula = document.createElement('div');
                    nebula.className = 'nebula';
                    nebula.style.left = Math.random() * 100 + '%';
                    nebula.style.top = Math.random() * 100 + '%';
                    nebula.style.background = nebulaColors[Math.floor(Math.random() * nebulaColors.length)];
                    nebula.style.animationDelay = Math.random() * 10 + 's';
                    fragment.appendChild(nebula);
                }

                // Stars
                const starColors = ['#9bb0ff', '#aabfff', '#cad7ff', '#f8f7ff', '#fff4ea', '#ffd2a1', '#ffcc6f'];
                for (let i = 0; i < numStars; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    const size = Math.random() * (isMobile ? 1.5 : 2) + 0.5;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.background = starColors[Math.floor(Math.random() * starColors.length)];
                    
                    // CSS Variable for Animation Control
                    star.style.setProperty('--duration', (2 + Math.random() * 4) + 's');
                    star.style.setProperty('--delay', (Math.random() * 5) + 's');
                    
                    fragment.appendChild(star);
                }

                // Pulsars
                const pulsarCount = isMobile ? 1 : 4;
                for(let i=0; i<pulsarCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star pulsar';
                    star.style.width = '3px';
                    star.style.height = '3px';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.background = '#aabfff';
                    fragment.appendChild(star);
                }

                space.appendChild(fragment);
                scheduleShootingStar();
            }

            function tryPlayAudio() {
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        audioStarted = true;
                    }).catch(error => {
                        console.log("Autoplay prevented. Waiting for interaction.");
                        // One-time listener for any interaction
                        const enableAudio = () => {
                            audio.play();
                            audioStarted = true;
                            ['click', 'touchstart', 'keydown'].forEach(evt => 
                                document.removeEventListener(evt, enableAudio)
                            );
                        };
                        
                        ['click', 'touchstart', 'keydown'].forEach(evt => 
                            document.addEventListener(evt, enableAudio, { once: true })
                        );
                    });
                }
            }

            // Start logic
            startVisuals();
            tryPlayAudio();
            
            // --- Optimized Animation Logic ---
            
            function createShootingStar() {
                // Limit concurrent shooting stars
                if(document.getElementsByClassName('shooting-star').length > 1) return;

                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                
                const startX = Math.random() * window.innerWidth;
                const startY = Math.random() * window.innerHeight * 0.4;
                const angle = 30 + Math.random() * 30;
                const distance = (isMobile ? 150 : 250) + Math.random() * 200;
                const duration = 1 + Math.random(); // Slightly slower is smoother
                
                shootingStar.style.left = startX + 'px';
                shootingStar.style.top = startY + 'px';
                
                space.appendChild(shootingStar);
                
                const endX = startX + distance * Math.cos(angle * Math.PI / 180);
                const endY = startY + distance * Math.sin(angle * Math.PI / 180);
                
                const animation = shootingStar.animate([
                    { transform: 'translate(0, 0) rotate(45deg)', opacity: 0 },
                    { transform: 'translate(0, 0) rotate(45deg)', opacity: 1, offset: 0.1 },
                    { transform: `translate(${endX - startX}px, ${endY - startY}px) rotate(45deg)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'linear'
                });
                
                animation.onfinish = () => shootingStar.remove();
            }
            
            function scheduleShootingStar() {
                if(document.hidden) {
                    setTimeout(scheduleShootingStar, 5000); // Check again later if tab hidden
                    return;
                }
                createShootingStar();
                const delay = isMobile ? (5000 + Math.random() * 8000) : (3000 + Math.random() * 6000);
                setTimeout(scheduleShootingStar, delay);
            }

            // --- Optimized Lyrics Logic ---
            
            // Throttle timeupdate or use requestAnimationFrame if really needed, 
            // but standard timeupdate is usually fine if logic is simple.
            audio.addEventListener('timeupdate', () => {
                const currentTime = audio.currentTime;
                
                // Handle Loop Reset
                if (currentTime < 1 && currentLyricIndex > lyricsData.length - 2) {
                    currentLyricIndex = -1;
                    lyricsDisplay.classList.remove('active');
                }
                
                // Binary search or simple lookahead could be faster for huge lists, 
                // but for ~30 items, linear scan is negligible.
                // We optimize by checking only if we need to update.
                
                // Find active lyric range
                const nextLyric = lyricsData[currentLyricIndex + 1];
                
                // Only search if we moved past the next lyric time
                if (nextLyric && currentTime >= nextLyric.time) {
                     for (let i = currentLyricIndex + 1; i < lyricsData.length; i++) {
                        if (currentTime >= lyricsData[i].time && 
                            (i === lyricsData.length - 1 || currentTime < lyricsData[i + 1].time)) {
                            
                            if (currentLyricIndex !== i) {
                                currentLyricIndex = i;
                                lyricsDisplay.classList.remove('active');
                                // Small delay for fade out effect
                                setTimeout(() => {
                                    lyricsDisplay.textContent = lyricsData[i].text;
                                    lyricsDisplay.classList.add('active');
                                }, 150); 
                            }
                            break;
                        }
                    }
                }
            });

            // Optimize Resize: only reload if strictly necessary, otherwise ignore
            // Mobile browsers trigger resize on scroll (address bar), so we ignore vertical resizes mostly
            let lastWidth = window.innerWidth;
            window.addEventListener('resize', () => {
                if(window.innerWidth !== lastWidth) {
                    lastWidth = window.innerWidth;
                    // Optional: logic to reset stars if width changes significantly (orientation change)
                }
            });
        });
    </script>
</body>
</html>
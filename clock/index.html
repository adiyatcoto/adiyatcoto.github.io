<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nested Time Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #ffffff;
            background: linear-gradient(-45deg, #111827, #1f2937, #374151, #111827);
            background-size: 400% 400%;
            animation: gradientAnimation 30s ease infinite;
            overflow-y: auto;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        svg {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            overflow: visible;
        }
        #tooltip {
            position: fixed;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none;
            z-index: 50;
        }
        #tooltip.visible {
            opacity: 1;
        }
        .ring-label {
            font-size: 1.7px;
            font-weight: 500;
            pointer-events: none;
        }
        
        /* Scrollbar aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        .glass-panel {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Beautiful Directive Card */
        .directive-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7) 0%, rgba(17, 24, 39, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .directive-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #f87171, #c084fc, #818cf8);
            box-shadow: 2px 0 15px rgba(248, 113, 113, 0.4);
        }

        /* Formal Font Styling */
        .formal-font {
            font-family: 'Playfair Display', serif;
        }
        
        .directive-text {
            font-family: 'Playfair Display', serif;
            line-height: 1.6;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 sm:p-6 pb-12">

    <div class="w-full max-w-7xl text-center mb-8 mt-4">
        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight text-white">Nested Time Visualization</h1>
        <p id="time-display" class="text-gray-400 mt-2 font-mono text-sm sm:text-base">Loading current time...</p>
    </div>

    <!-- Main Grid Layout -->
    <div class="w-full max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8 items-start mb-12">
        
        <!-- Visualization Column -->
        <div id="visualization" class="lg:col-span-8 w-full aspect-square relative">
             <svg viewBox="-5 -5 110 110" id="geometric-svg">
                <!-- Geometric shapes will be generated by JS -->
             </svg>
        </div>

        <!-- Contextual Situation Column (Beside the Chart) -->
        <div class="lg:col-span-4 flex flex-col gap-6">
            
            <!-- Live Context Panel -->
            <div class="glass-panel rounded-xl p-6 shadow-2xl">
                <div class="flex items-center gap-2 mb-4 border-b border-gray-700 pb-3">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <h2 class="text-lg font-bold text-white uppercase tracking-wider">Situational Analysis</h2>
                </div>

                <div class="space-y-5 overflow-y-auto max-h-[60vh] pr-2 custom-scrollbar">
                    
                    <!-- Millennium -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>MILLENNIUM</span>
                            <span id="millennium-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="millennium-bar" class="h-full bg-indigo-600 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="millennium-context" class="text-xs text-gray-400 font-medium">Loading...</p>
                    </div>

                    <!-- Century -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>CENTURY</span>
                            <span id="century-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="century-bar" class="h-full bg-violet-600 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="century-context" class="text-xs text-gray-400 font-medium">Loading...</p>
                    </div>

                    <!-- Decade -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>DECADE</span>
                            <span id="decade-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="decade-bar" class="h-full bg-fuchsia-600 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="decade-context" class="text-xs text-gray-400 font-medium">Loading...</p>
                    </div>

                    <!-- Year -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>YEAR</span>
                            <span id="year-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="year-bar" class="h-full bg-blue-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="year-context" class="text-xs text-gray-200 font-medium">Loading...</p>
                    </div>

                    <!-- Month -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>MONTH</span>
                            <span id="month-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="month-bar" class="h-full bg-emerald-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="month-context" class="text-xs text-gray-200 font-medium">Loading...</p>
                    </div>

                    <!-- Week -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>WEEK</span>
                            <span id="week-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="week-bar" class="h-full bg-yellow-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="week-context" class="text-xs text-gray-200 font-medium">Loading...</p>
                    </div>

                    <!-- Day -->
                    <div>
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>DAY</span>
                            <span id="day-percent" class="text-white font-mono">0%</span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden mb-1">
                            <div id="day-bar" class="h-full bg-purple-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="day-context" class="text-xs text-gray-200 font-medium">Loading...</p>
                    </div>

                    <!-- Strategic Advice Box -->
                    <div class="mt-6 directive-card rounded-lg p-5">
                        <h3 class="text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-purple-400 uppercase mb-3 tracking-widest formal-font">Temporal Synthesis</h3>
                        <p id="strategic-advice" class="directive-text text-base">
                            Analyzing temporal coordinates...
                        </p>
                    </div>
                </div>
            </div>

            <!-- Mini Legend for Context -->
            <div class="glass-panel rounded-xl p-5 text-xs text-gray-400">
                <h3 class="font-bold text-white mb-3 uppercase tracking-wider">Phase Key</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-sm bg-gray-700 border border-gray-500"></div>
                        <span>Discovery (0-25%)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-sm bg-gray-600 border border-gray-500"></div>
                        <span>Development (25-50%)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-sm bg-gray-500 border border-gray-500"></div>
                        <span>Acceleration (50-75%)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-sm bg-gray-800 border border-red-400"></div>
                        <span>Resolution (75-100%)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Restored Footer Content -->
    <div class="w-full max-w-5xl mx-auto text-gray-300 text-sm px-4">
        <div class="glass-panel rounded-xl p-8 mb-8">
            <h2 class="text-xl font-semibold text-white mb-4">About This Visualization</h2>
            <p class="mb-4 text-gray-300 leading-relaxed">
                This is an interactive artwork that visualizes the nested, cyclical nature of time. Each concentric ring represents a different unit of time, from the outermost <span class="font-semibold text-white">Millennium</span> ring to the innermost <span class="font-semibold text-white">Second</span> ring.
            </p>
            <p class="mb-4 text-gray-300 leading-relaxed">
                The dark, filled portion of each ring shows the progress through that specific time unit. You can <span class="font-semibold text-white">hover your mouse</span> over any ring to see precise details, including the current value, the percentage of completion, and the midpoint of that cycle.
            </p>
            <p class="mb-4 text-gray-300 leading-relaxed">
                The labels on the exterior—<span class="font-semibold text-red-400">Discovery, Development, Acceleration, Resolution</span>—represent the four conceptual quarters of any cycle, suggesting a narrative arc to the passage of time.
            </p>
        </div>

        <div class="glass-panel rounded-xl p-8 mb-8">
            <h2 class="text-xl font-semibold text-white mb-6 text-center">Timeframe Interpretation</h2>
            <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">
                <div>
                    <h3 class="font-semibold text-white mb-3 text-lg border-b border-gray-700 pb-2">The Rings (Largest to Smallest)</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><span class="font-bold text-gray-100">Millennium:</span> A full 1000-year cycle.</li>
                        <li><span class="font-bold text-gray-100">Century:</span> 100 years, marking generational shifts.</li>
                        <li><span class="font-bold text-gray-100">Decade:</span> A 10-year period, often defining cultural trends.</li>
                        <li><span class="font-bold text-gray-100">Year:</span> The Earth's complete orbit around the sun.</li>
                        <li><span class="font-bold text-gray-100">Semester:</span> A 6-month block, a half-year review.</li>
                        <li><span class="font-bold text-gray-100">Quarter:</span> A 3-month period, common in business and nature.</li>
                        <li><span class="font-bold text-gray-100">Month:</span> The approximate cycle of the moon.</li>
                        <li><span class="font-bold text-gray-100">Week:</span> A 7-day cycle, structuring our work and rest.</li>
                        <li><span class="font-bold text-gray-100">Day:</span> A full rotation of the Earth.</li>
                        <li><span class="font-bold text-gray-100">4-Hour:</span> A segment of the day (morning, afternoon, etc.).</li>
                        <li><span class="font-bold text-gray-100">Hour, Mins, etc:</span> The familiar granular units of our immediate experience.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-white mb-3 text-lg border-b border-gray-700 pb-2">The Four Quarters of a Cycle</h3>
                    <p class="mb-3 text-sm italic text-gray-400">These conceptual labels apply to any time ring, suggesting a universal pattern in how cycles unfold:</p>
                    <ul class="space-y-4">
                        <li>
                            <span class="font-bold text-red-400 block mb-1">Discovery (0-25%)</span>
                            <span class="text-gray-300">The beginning phase. It's a time of inception, planning, learning, and gathering resources. The foundation for the entire cycle is laid here.</span>
                        </li>
                        <li>
                            <span class="font-bold text-red-400 block mb-1">Development (25-50%)</span>
                            <span class="text-gray-300">The growth phase. This is where active building, execution, and hard work take place. Ideas turn into tangible progress.</span>
                        </li>
                        <li>
                            <span class="font-bold text-red-400 block mb-1">Acceleration (50-75%)</span>
                            <span class="text-gray-300">The momentum phase. Progress is rapid as the cycle reaches maturity. It's often the busiest and most productive period, where the culmination of earlier efforts is realized.</span>
                        </li>
                        <li>
                            <span class="font-bold text-red-400 block mb-1">Resolution (75-100%)</span>
                            <span class="text-gray-300">The completion phase. The cycle is winding down. This period is for finalizing work, reflecting on outcomes, and preparing for the transition to the next cycle.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="w-full max-w-5xl mx-auto mt-4 text-center text-gray-500 text-xs pb-8">
        <p>&copy; <span id="copyright-year"></span> Adiyat Coto. All Rights Reserved.</p>
    </footer>

    <div id="tooltip" class="rounded-md bg-gray-900 bg-opacity-90 border border-gray-700 px-3 py-2 text-sm text-white shadow-xl backdrop-blur-md"></div>

    <script>
        const svgContainer = document.getElementById('geometric-svg');
        const timeDisplay = document.getElementById('time-display');
        const tooltip = document.getElementById('tooltip');

        // Context Elements
        const millenniumBar = document.getElementById('millennium-bar');
        const millenniumPercent = document.getElementById('millennium-percent');
        const millenniumContext = document.getElementById('millennium-context');

        const centuryBar = document.getElementById('century-bar');
        const centuryPercent = document.getElementById('century-percent');
        const centuryContext = document.getElementById('century-context');

        const decadeBar = document.getElementById('decade-bar');
        const decadePercent = document.getElementById('decade-percent');
        const decadeContext = document.getElementById('decade-context');

        const yearBar = document.getElementById('year-bar');
        const yearPercent = document.getElementById('year-percent');
        const yearContext = document.getElementById('year-context');
        
        const monthBar = document.getElementById('month-bar');
        const monthPercent = document.getElementById('month-percent');
        const monthContext = document.getElementById('month-context');

        const weekBar = document.getElementById('week-bar');
        const weekPercent = document.getElementById('week-percent');
        const weekContext = document.getElementById('week-context');

        const dayBar = document.getElementById('day-bar');
        const dayPercent = document.getElementById('day-percent');
        const dayContext = document.getElementById('day-context');

        const strategicAdvice = document.getElementById('strategic-advice');

        // --- Time Configuration ---
        const visitorTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const locationName = visitorTimezone.split('/').pop().replace(/_/g, ' ');

        const timeUnits = [
            { name: 'Millennium' }, { name: 'Century' }, { name: 'Decade' },
            { name: 'Year' }, { name: 'Semester' }, { name: 'Quarter' },
            { name: 'Month' }, { name: 'Week' }, { name: 'Day' },
            { name: '4-Hour' }, { name: 'Hour' }, { name: '30 Mins' },
            { name: '15 Mins' }, { name: '5 Mins' }, { name: 'Mins' },
            { name: 'Second' },
        ];

        // --- Phase Logic ---
        const phases = [
            { name: "Discovery", desc: "Foundations & planning.", advice: "focus on strategy and learning" },
            { name: "Development", desc: "Building & execution.", advice: "put your head down and build" },
            { name: "Acceleration", desc: "Momentum & production.", advice: "push for maximum output" },
            { name: "Resolution", desc: "Completion & reflection.", advice: "reflect and prepare for the next cycle" }
        ];

        function getPhaseInfo(progress) {
            const index = Math.floor(progress * 4);
            const safeIndex = Math.min(index, 3);
            return phases[safeIndex];
        }

        function calculateProgress(unit, now) {
            const fullYear = now.getFullYear();
            const month = now.getMonth();
            const dayOfMonth = now.getDate();
            const dayOfWeek = now.getDay();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const milliseconds = now.getMilliseconds();
            const daysInMonth = new Date(fullYear, month + 1, 0).getDate();
            
            let progress = 0;
            let valueLabel = '';
            let midpointLabel = '';

            const dateOptions = { month: 'short', day: 'numeric', year: 'numeric' };
            
            const formatMsToMinSec = (ms) => {
                const totalSeconds = Math.floor(ms / 1000);
                const mins = Math.floor(totalSeconds / 60);
                const secs = totalSeconds % 60;
                return `${mins}m ${secs}s`;
            };
            
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const timeElapsedTodayMs = now.getTime() - startOfDay.getTime();
            const progressOfDay = timeElapsedTodayMs / 86400000;

            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const timeElapsedInYearMs = now.getTime() - startOfYear.getTime();
            const totalMsInYear = new Date(now.getFullYear() + 1, 0, 1).getTime() - startOfYear.getTime();
            const progressOfYear = timeElapsedInYearMs / totalMsInYear;

            switch (unit) {
                case 'Second':
                    progress = milliseconds / 1000;
                    valueLabel = `${milliseconds}ms`;
                    midpointLabel = '500 mil-secs';
                    break;
                case 'Mins':
                    progress = (seconds * 1000 + milliseconds) / 60000;
                    valueLabel = `Sec ${seconds + 1}/60`;
                    midpointLabel = '30 secs';
                    break;
                case '5 Mins': {
                    const blockDuration = 300000;
                    progress = (timeElapsedTodayMs % blockDuration) / blockDuration;
                    valueLabel = `${formatMsToMinSec(timeElapsedTodayMs % blockDuration)} / 5m`;
                    midpointLabel = '2m 30s';
                    break;
                }
                case '15 Mins': {
                    const blockDuration = 900000;
                    progress = (timeElapsedTodayMs % blockDuration) / blockDuration;
                    valueLabel = `${formatMsToMinSec(timeElapsedTodayMs % blockDuration)} / 15m`;
                    midpointLabel = '7m 30s';
                    break;
                }
                case '30 Mins': {
                    const blockDuration = 1800000;
                    progress = (timeElapsedTodayMs % blockDuration) / blockDuration;
                    valueLabel = `${formatMsToMinSec(timeElapsedTodayMs % blockDuration)} / 30m`;
                    midpointLabel = '15m 0s';
                    break;
                }
                case 'Hour':
                    progress = ((minutes * 60000) + (seconds * 1000) + milliseconds) / 3600000;
                    valueLabel = `Min ${minutes + 1}/60`;
                    midpointLabel = '30m 0s';
                    break;
                case '4-Hour': {
                    const blockDuration = 14400000;
                    progress = (timeElapsedTodayMs % blockDuration) / blockDuration;
                    const hourIntoSegment = hours % 4;
                    valueLabel = `Hour ${hourIntoSegment + 1}/4`;
                    midpointLabel = `End of hour ${Math.floor(hours/4)*4 + 2}`;
                    break;
                }
                case 'Day':
                    progress = progressOfDay;
                    valueLabel = `${hours}:${String(minutes).padStart(2,'0')}`;
                    midpointLabel = `Noon, ${now.toLocaleDateString('en-US', dateOptions)}`;
                    break;
                case 'Week': {
                    const adjustedDayOfWeek = (dayOfWeek === 0) ? 6 : dayOfWeek - 1;
                    progress = (adjustedDayOfWeek + progressOfDay) / 7;
                    valueLabel = `Day ${adjustedDayOfWeek + 1}/7`;
                    const midpointDate = new Date(now);
                    midpointDate.setDate(now.getDate() - adjustedDayOfWeek + 3);
                    midpointLabel = `Noon, ${midpointDate.toLocaleDateString('en-US', { weekday: 'long', ...dateOptions })}`;
                    break;
                }
                case 'Month':
                    progress = (dayOfMonth - 1 + progressOfDay) / daysInMonth;
                    valueLabel = `Day ${dayOfMonth}/${daysInMonth}`;
                    const midDay = Math.ceil(daysInMonth / 2);
                    midpointLabel = daysInMonth % 2 !== 0 ? `Noon, ${now.toLocaleString('en-US', {month:'short'})} ${midDay}` : `Midnight between ${now.toLocaleString('en-US', {month:'short'})} ${midDay} & ${midDay + 1}`;
                    break;
                case 'Quarter': {
                    const monthWithFraction = month + (dayOfMonth - 1 + progressOfDay) / daysInMonth;
                    progress = (monthWithFraction % 3) / 3;
                    valueLabel = `Month ${month % 3 + 1}/3`;
                    const midMonthIndex = Math.floor(month / 3) * 3 + 1;
                    const midMonthName = new Date(fullYear, midMonthIndex, 1).toLocaleString('en-US', { month: 'long' });
                    const midDayQM = Math.ceil(new Date(fullYear, midMonthIndex + 1, 0).getDate()/2);
                    midpointLabel = `Noon, ${midMonthName} ${midDayQM}`;
                    break;
                }
                case 'Semester': {
                     const monthWithFraction = month + (dayOfMonth - 1 + progressOfDay) / daysInMonth;
                    progress = (monthWithFraction % 6) / 6;
                    valueLabel = `Month ${month % 6 + 1}/6`;
                    const startOfSemesterMonth = Math.floor(month/6)*6;
                    const endOfThirdMonth = new Date(fullYear, startOfSemesterMonth + 3, 0);
                    midpointLabel = `Midnight, ${endOfThirdMonth.toLocaleString('en-US', {...dateOptions})}`;
                    break;
                }
                case 'Year':
                    progress = progressOfYear;
                    valueLabel = `Month ${month + 1}/12`;
                    const isLeap = (fullYear % 4 === 0 && (fullYear % 100 !== 0 || fullYear % 400 === 0));
                    midpointLabel = `Noon, Jul ${isLeap ? 1 : 2}, ${fullYear}`;
                    break;
                case 'Decade':
                    progress = ((fullYear % 10) + progressOfYear) / 10;
                    valueLabel = `Year ${fullYear % 10 + 1}/10`;
                    midpointLabel = `Midnight, Dec 31, ${Math.floor(fullYear/10)*10 + 4}`;
                    break;
                case 'Century':
                    progress = (((fullYear-1) % 100) + progressOfYear) / 100;
                    valueLabel = `Decade ${Math.floor(((fullYear-1)%100)/10)+1}/10`;
                    midpointLabel = `Midnight, Dec 31, ${Math.floor((fullYear-1)/100)*100 + 50}`;
                    break;
                case 'Millennium':
                    progress = (((fullYear-1) % 1000) + progressOfYear) / 1000;
                    valueLabel = `Century ${Math.floor(((fullYear-1)%1000)/100)+1}/10`;
                    midpointLabel = `Midnight, Dec 31, ${Math.floor((fullYear-1)/1000)*1000 + 500}`;
                    break;
            }
            return { progress, valueLabel, percentage: `${(progress * 100).toFixed(2)}%`, midpointLabel };
        }

        // --- Narrative Synthesis Logic ---
        function generateNarrative(phases, now) {
            const { year, month, week, day, decade } = phases;

            // 1. MACRO: Year & Decade setting the scene
            const macroNarratives = {
                "Discovery": "You are currently planting seeds in a year defined by new beginnings.",
                "Development": "This year is about active construction; you are in the thick of building your vision.",
                "Acceleration": "You are riding the momentum of a high-velocity year; everything is moving fast.",
                "Resolution": "The year is winding down, calling for deep reflection and closure to prepare for what's next."
            };

            // 2. MESO: Month/Week Nuance
            // We'll use the Month to provide the immediate tactical context
            const mesoNarratives = {
                "Discovery": "With the month just starting, use this fresh energy to set clear intentions.",
                "Development": "The month is in full swing; focus on executing your core tasks without hesitation.",
                "Acceleration": "You are at the peak of the month's cycle—push hard now to maximize your output.",
                "Resolution": "As the month concludes, wrap up loose ends and consolidate your wins."
            };

            // 3. MICRO: Day Action
            // This needs to be time-aware (morning vs evening) to be truly smart.
            const hour = now.getHours();
            let microAction = "";

            if (day.name === "Resolution") {
                // Evening/End of Day
                microAction = "The day is resolving. It is time to disconnect, rest, and integrate today's lessons.";
            } else if (hour < 10) { 
                // Morning (likely Discovery phase of day)
                microAction = "Right now, the day is young. Seize these early hours to strategize before the noise begins.";
            } else if (hour >= 10 && hour < 18) {
                // Mid-day (Development/Acceleration)
                microAction = "In this active part of the day, eliminate distractions and focus on deep work.";
            } else {
                 // Fallback
                microAction = `The day's phase suggests you should ${day.advice}.`;
            }

            // Combine them beautifully
            return `"${macroNarratives[year.name]} ${mesoNarratives[month.name]} ${microAction} All while contributing to the ${decade.name.toLowerCase()} phase of this decade."`;
        }

        function updateSidePanel(now) {
            // Calculate Progress
            const milData = calculateProgress('Millennium', now);
            const cenData = calculateProgress('Century', now);
            const decData = calculateProgress('Decade', now);
            const yearData = calculateProgress('Year', now);
            const monthData = calculateProgress('Month', now);
            const weekData = calculateProgress('Week', now);
            const dayData = calculateProgress('Day', now);

            // Get Phase Info
            const milPhase = getPhaseInfo(milData.progress);
            const cenPhase = getPhaseInfo(cenData.progress);
            const decPhase = getPhaseInfo(decData.progress);
            const yearPhase = getPhaseInfo(yearData.progress);
            const monthPhase = getPhaseInfo(monthData.progress);
            const weekPhase = getPhaseInfo(weekData.progress);
            const dayPhase = getPhaseInfo(dayData.progress);

            // Update DOM Elements
            
            // Millennium
            millenniumBar.style.width = milData.percentage;
            millenniumPercent.textContent = milData.percentage;
            millenniumContext.innerHTML = `<span class="text-indigo-400 font-bold">${milPhase.name}:</span> We are in Century ${Math.floor(((now.getFullYear()-1)%1000)/100)+1} of the millennium.`;

            // Century
            centuryBar.style.width = cenData.percentage;
            centuryPercent.textContent = cenData.percentage;
            centuryContext.innerHTML = `<span class="text-violet-400 font-bold">${cenPhase.name}:</span> Decade ${Math.floor(((now.getFullYear()-1)%100)/10)+1} of the 21st Century.`;

            // Decade
            decadeBar.style.width = decData.percentage;
            decadePercent.textContent = decData.percentage;
            decadeContext.innerHTML = `<span class="text-fuchsia-400 font-bold">${decPhase.name}:</span> Year ${now.getFullYear() % 10 + 1} of the ${Math.floor(now.getFullYear()/10)*10}s.`;

            // Year
            yearBar.style.width = yearData.percentage;
            yearPercent.textContent = yearData.percentage;
            yearContext.innerHTML = `<span class="text-blue-400 font-bold">${yearPhase.name}:</span> Month ${now.getMonth() + 1}/12. ${yearPhase.desc}`;

            // Month
            monthBar.style.width = monthData.percentage;
            monthPercent.textContent = monthData.percentage;
            monthContext.innerHTML = `<span class="text-emerald-400 font-bold">${monthPhase.name}:</span> Day ${now.getDate()}. ${monthPhase.desc}`;

            // Week
            weekBar.style.width = weekData.percentage;
            weekPercent.textContent = weekData.percentage;
            const weekDayName = now.toLocaleDateString('en-US', { weekday: 'long' });
            weekContext.innerHTML = `<span class="text-yellow-400 font-bold">${weekPhase.name}:</span> It's ${weekDayName}. ${weekPhase.desc}`;

            // Day
            dayBar.style.width = dayData.percentage;
            dayPercent.textContent = dayData.percentage;
            dayContext.innerHTML = `<span class="text-purple-400 font-bold">${dayPhase.name}:</span> ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}. ${dayPhase.desc}`;

            // New Narrative Generation
            const phaseCollection = {
                year: yearPhase,
                month: monthPhase,
                week: weekPhase,
                day: dayPhase,
                decade: decPhase
            };
            
            strategicAdvice.textContent = generateNarrative(phaseCollection, now).replace(/"/g, '');
        }

        function render(now) {
            const center_x = 50;
            const center_y = 50;
            const initialRadius = 50; 
            const ringWidth = initialRadius / timeUnits.length;
            
            let elements = [];
            for (let i = 0; i < timeUnits.length; i++) {
                const radius = initialRadius - (i * ringWidth);
                if (radius <= 0) break;
                const unit = timeUnits[i];
                const unitData = calculateProgress(unit.name, now);
                const nextRadius = radius - ringWidth;
                elements.push({ ...unitData, unitName: unit.name, radius, nextRadius });
            }
            
            let defsContent = '';
            let circleContent = '';
            let labelContent = '';
            let externalLabelContent = '';

            elements.forEach(el => {
                const { progress, valueLabel, unitName, radius, nextRadius } = el;
                const safeUnitName = unitName.replace(/[^a-zA-Z0-9]/g, '-');
                const angle = progress * 360;
                const clipId = `clip-${safeUnitName}`;
                
                const x2 = center_x + radius * Math.sin(angle * Math.PI / 180);
                const y2 = center_y - radius * Math.cos(angle * Math.PI / 180);
                const largeArcFlag = angle > 180 ? 1 : 0;
                const clipPathD = `M ${center_x},${center_y} L ${center_x},${center_y-radius} A ${radius},${radius} 0 ${largeArcFlag},1 ${x2},${y2} Z`;
                defsContent += `<clipPath id="${clipId}"><path d="${clipPathD}" /></clipPath>`;

                const dataAttributes = `data-unit="${el.unitName}" data-value="${el.valueLabel}" data-percentage="${el.percentage}" data-midpoint="${el.midpointLabel}"`;
                const ringClipId = `ring-clip-${safeUnitName}`;
                defsContent += `<clipPath id="${ringClipId}"><path d="M${center_x-radius},${center_y} A${radius},${radius} 0 1 1 ${center_x+radius},${center_y} A${radius},${radius} 0 1 1 ${center_x-radius},${center_y}Z M${center_x-nextRadius},${center_y} A${nextRadius},${nextRadius} 0 1 0 ${center_x+nextRadius},${center_y} A${nextRadius},${nextRadius} 0 1 0 ${center_x-nextRadius},${center_y}Z" fill-rule="evenodd" /></clipPath>`;

                circleContent += `<circle class="time-circle" ${dataAttributes} cx="${center_x}" cy="${center_y}" r="${radius}" fill="#ffffff" clip-path="url(#${ringClipId})" />`;
                circleContent += `<circle class="time-circle" ${dataAttributes} cx="${center_x}" cy="${center_y}" r="${radius}" fill="#000000" clip-path="url(#${clipId})" />`;
                
                if (radius > nextRadius && nextRadius >= 0) {
                    const markerStroke = "#f87171";
                    [0, 90, 180, 270].forEach(a => {
                        const rad = a * Math.PI / 180;
                        const [x1, y1] = [center_x + nextRadius * Math.sin(rad), center_y - nextRadius * Math.cos(rad)];
                        const [x2, y2] = [center_x + radius * Math.sin(rad), center_y - radius * Math.cos(rad)];
                        circleContent += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${markerStroke}" stroke-width="0.15" stroke-dasharray="0.2" pointer-events="none" />`;
                    });
                }
                
                const labelRadius = nextRadius + ringWidth / 2;
                if (labelRadius > 4) {
                    const textPathId = `text-path-${safeUnitName}`;
                    defsContent += `<path id="${textPathId}" d="M ${center_x},${center_y - labelRadius} A ${labelRadius},${labelRadius} 0 1 1 ${center_x - 0.01},${center_y - labelRadius} Z" fill="none" />`;
                    const readableLabel = `${unitName}: ${valueLabel}`;
                    const startOffset = `${progress * 100}%`;
                    labelContent += `<text class="ring-label" fill="#000"><textPath href="#${textPathId}" startOffset="${startOffset}" text-anchor="middle">${readableLabel}</textPath></text>`;
                    labelContent += `<text class="ring-label" fill="#FFF" clip-path="url(#${clipId})"><textPath href="#${textPathId}" startOffset="${startOffset}" text-anchor="middle">${readableLabel}</textPath></text>`;
                }
            });
            
            const externalQuadrantRadius = 52.5;
            const externalPercentRadius = 51.5;

            const quadrantPathId = 'quadrant-path';
            defsContent += `<path id="${quadrantPathId}" d="M ${center_x},${center_y - externalQuadrantRadius} A ${externalQuadrantRadius},${externalQuadrantRadius} 0 1 1 ${center_x-0.01},${center_y - externalQuadrantRadius}Z" fill="none" />`;
            
            const percentPathId = 'percent-path';
            defsContent += `<path id="${percentPathId}" d="M ${center_x},${center_y - externalPercentRadius} A ${externalPercentRadius},${externalPercentRadius} 0 1 1 ${center_x-0.01},${center_y - externalPercentRadius}Z" fill="none" />`;

            const quadrantStyle = 'font-size: 3px; font-weight: 600; fill: #ffffff; letter-spacing: 0.2px;';
            const percentStyle = 'font-size: 3px; font-weight: 700; fill: #f87171;';

            const addCurvedText = (text, pathId, offset, style) => `<text style="${style}"><textPath href="#${pathId}" startOffset="${offset}" text-anchor="middle">${text}</textPath></text>`;

            externalLabelContent += addCurvedText('Discovery', quadrantPathId, '12.5%', quadrantStyle);
            externalLabelContent += addCurvedText('Development', quadrantPathId, '37.5%', quadrantStyle);
            externalLabelContent += addCurvedText('Acceleration', quadrantPathId, '62.5%', quadrantStyle);
            externalLabelContent += addCurvedText('Resolution', quadrantPathId, '87.5%', quadrantStyle);

            externalLabelContent += addCurvedText('0%', percentPathId, '0.5%', percentStyle);
            externalLabelContent += addCurvedText('25%', percentPathId, '25%', percentStyle);
            externalLabelContent += addCurvedText('50%', percentPathId, '50%', percentStyle);
            externalLabelContent += addCurvedText('75%', percentPathId, '75%', percentStyle);

            svgContainer.innerHTML = `<defs>${defsContent}</defs>${circleContent}${labelContent}${externalLabelContent}`;
        }
        
        function updateTime() {
            const now = new Date();
            timeDisplay.textContent = now.toLocaleString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                timeZone: visitorTimezone,
                timeZoneName: 'short'
            }) + ` (Current Time in ${locationName})`;
            
            render(now);
            updateSidePanel(now); // Update the new side panel
        }

        svgContainer.addEventListener('mousemove', (e) => {
            const target = e.target.closest('.time-circle');
            if (target) {
                const { unit, value, percentage, midpoint } = target.dataset;
                tooltip.innerHTML = `<div class="font-bold text-gray-200">${unit} (${percentage})</div><div class="text-gray-300">${value}</div><div class="text-xs text-red-400 mt-1">Midpoint: ${midpoint}</div>`;
                tooltip.style.left = `${e.clientX + 15}px`;
                tooltip.style.top = `${e.clientY + 15}px`;
                tooltip.classList.add('visible');
            } else {
                 tooltip.classList.remove('visible');
            }
        });

        svgContainer.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));

        setInterval(updateTime, 100);
        updateTime();

        document.getElementById('copyright-year').textContent = new Date().getFullYear();

    </script>
</body>
</html>